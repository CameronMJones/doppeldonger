<!DOCTYPE html>
<html lang="en">

<%
require './lib/donger_rest'
require './lib/donger_graph'

graph = DongerGraph.new()
mastery_data = graph.get_mastery(summonername)["data"]
if mastery_data.length == 0
  summoner = DongerRest.get_summoners([summonername]).values[0]
  id = summoner["id"]
  masteries = DongerRest.get_masteries(id)
  raise "No Masteries" if masteries.length == 0
  graph.add_summoner(id, summonername)
  masteries.each do |mastery|
    graph.add_mastery(id, mastery["championId"], mastery["championPoints"])
  end
end

recommendation = graph.recommend(summonername)["data"]
champion_pool = recommendation.map{|row| row[0]["data"]["name"]}

# champion_pool = ["Bard","Aatrox","Ahri"]
%>

<body onLoad="selectChampion('<%=champion_pool[0]%>')">
  <section id="portfolio">
    <div class="container" style="padding-top:50px;">
      <div class="col-lg-6">
        <div class="row">
          <div class="col-sm-12 portfolio-item">
            <div class="col-lg-12 text-center">
              <h2>Select Another Summoner?</h2>
            </div>
            <%= erb :select_a_summoner %>
          </div>
        </div>
        <div class="row">
          <div class="col-sm-12 portfolio-item">
            Recommendation Text Goes Here
          </div>
        </div>
      </div>
      <div class="col-lg-6">
        <div class="col-sm-12 portfolio-item">
          <div width="100%" align="center">
            <input type="radio" id="<%=champion_pool[0]%>" name="selected_champion" value="<%=champion_pool[0]%>" onclick="selectChampion('<%=champion_pool[0]%>')" checked>
              <label for="<%=champion_pool[0]%>"><%=champion_pool[0]%></label>
            <% champion_pool.drop(1).each do |champion| %>
            <input type="radio" id="<%=champion%>" name="selected_champion" value="<%=champion%>" onclick="selectChampion('<%=champion%>')">
              <label for="<%=champion%>"><%=champion%></label>
            <% end %>
          <div id="recommended_champion" width="100%" align="center">
          </div>
        </div>
      </div>
    </div>
  </section>

  <script>
    function selectChampion(champion) {
      var champion_image = document.createElement("img");
      var node = document.getElementById("recommended_champion");
      var sanitized_champion_name = champion.replace(/\W/g, '');

      champion_image.src = "http://ddragon.leagueoflegends.com/cdn/img/champion/loading/"+sanitized_champion_name+"_0.jpg";
      champion_image.style.position = "relative"; 
      champion_image.style.width = "50%";
      champion_image.style.height = "50%";

      while (node.hasChildNodes()) {
        node.removeChild(node.lastChild);
      }

      node.appendChild(champion_image);
    }
  </script>
</body>
</html>
